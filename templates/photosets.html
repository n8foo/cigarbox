{% extends "layout.html" %}
{% from "_pagination.html" import render_pagination %}
{% block body %}
<div>
  <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 row-cols-lg-5 row-cols-xl-6 g-3">
    {%- for photoset in photosets %}
    <div class="col">
      <div class="panel panel-default" style="margin-bottom: 0;">
        <div class="panel-heading" style="padding: 8px 10px;">
          <h3 class="panel-title" style="font-size: 14px; margin: 0;"><a href="{{SITEURL}}/photosets/{{ photoset.id }}">{{ photoset.title }}</a><h3>
          {% if privacy_counts and photoset.id in privacy_counts %}
          <div class="privacy-badges" style="margin-top: 4px; font-size: 12px;">
            {% set counts = privacy_counts[photoset.id] %}
            {% if 0 in counts %}
            <a href="{{SITEURL}}/photosets/{{ photoset.id }}?p=0" class="text-decoration-none" style="margin-right: 8px;" title="Public photos">
              ğŸŒ {{ counts[0] }}
            </a>
            {% endif %}
            {% if 1 in counts %}
            <a href="{{SITEURL}}/photosets/{{ photoset.id }}?p=1" class="text-decoration-none" style="margin-right: 8px;" title="Friends only photos">
              ğŸ‘¥ {{ counts[1] }}
            </a>
            {% endif %}
            {% if 2 in counts %}
            <a href="{{SITEURL}}/photosets/{{ photoset.id }}?p=2" class="text-decoration-none" style="margin-right: 8px;" title="Family photos">
              ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ {{ counts[2] }}
            </a>
            {% endif %}
            {% if 3 in counts %}
            <a href="{{SITEURL}}/photosets/{{ photoset.id }}?p=3" class="text-decoration-none" style="margin-right: 8px;" title="Private photos">
              ğŸ”’ {{ counts[3] }}
            </a>
            {% endif %}
          </div>
          {% endif %}
        </div>
        <div class="panel-body" style="padding: 10px;">
          <a href="{{SITEURL}}/photosets/{{ photoset.id }}">
          {% for thumb in photoset.thumbs %}
          <img class="img-thumbnail lazy"
               data-src="http://s3.amazonaws.com/{{ config['S3_BUCKET_NAME'] }}/{{ thumb.uri }}"
               src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240'%3E%3Crect fill='%23eee' width='240' height='240'/%3E%3C/svg%3E"
               alt="Responsive image"
               style="max-width: 150px; height: auto;">
          {% endfor %}
          </a>
        </div>
      </div>
    </div>
    {% else %}
    <div class="col-12">
      <p class="text-muted">No photosets!</p>
    </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {{ render_pagination(pagination, baseurl) }}
</div>

<script>
// Lazy load images
document.addEventListener('DOMContentLoaded', function() {
  var lazyImages = document.querySelectorAll('img.lazy');

  if ('IntersectionObserver' in window) {
    var imageObserver = new IntersectionObserver(function(entries, observer) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          var img = entry.target;
          img.src = img.dataset.src;
          img.classList.remove('lazy');
          imageObserver.unobserve(img);
        }
      });
    }, {
      rootMargin: '200px'
    });

    lazyImages.forEach(function(img) {
      imageObserver.observe(img);
    });
  } else {
    // Fallback for older browsers
    lazyImages.forEach(function(img) {
      img.src = img.dataset.src;
    });
  }
});
</script>

<br><br>
{% endblock %}