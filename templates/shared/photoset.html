{% extends "layout.html" %}

{# Set Open Graph variables for social media preview #}
{% set og_title = 'Shared Photoset: ' + photoset.title %}
{% set og_url = request.url %}
{% set og_description = photoset.description or 'A shared photoset from CigarBox' %}

{% block body %}

<div class="row">
  <div class="col-md-12">
    <h1>{{ photoset.title }}</h1>
    {% if photoset.description %}
    <p class="lead">{{photoset.description}}</p>
    {% endif %}
    {% if date_range %}
    <p class="text-muted" style="font-size: 16px; margin-top: -10px; margin-bottom: 5px;">
      <span class="bi bi-calendar"></span> {{ date_range }}
    </p>
    {% endif %}
  </div>
</div>
<hr>

<div class="justified-gallery" id="photo-grid">
  {% for photo in photos %}
  <div class="jg-item-wrapper" style="display: inline-block; position: relative;">
    <a href="{{SITEURL}}/shared/photoset/{{ share_token.token }}/photo/{{ photo.id }}" class="jg-item">
      <img class="lazy jg-photo"
           data-src="{{ signed_s3_url(photo.uri, '_c') }}"
           src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='320' height='240'%3E%3Crect fill='%23eee' width='320' height='240'/%3E%3C/svg%3E"
           alt="Photo {{ photo.id }}">
    </a>
  </div>
  {% else %}
  <p class="text-muted">No photos in this photoset.</p>
  {% endfor %}
</div>

<style>
/* Justified gallery styles */
.justified-gallery {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-bottom: 20px;
}

.jg-item-wrapper {
  flex: 1 1 auto;
  min-width: 200px;
  max-width: 400px;
}

.jg-item {
  display: block;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

.jg-photo {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  transition: transform 0.2s;
}

.jg-photo:hover {
  transform: scale(1.05);
}
</style>

<script>
// Lazy load images
document.addEventListener('DOMContentLoaded', function() {
  var lazyImages = document.querySelectorAll('img.lazy');

  if ('IntersectionObserver' in window) {
    var imageObserver = new IntersectionObserver(function(entries, observer) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          var img = entry.target;
          img.src = img.dataset.src;
          img.classList.remove('lazy');
          imageObserver.unobserve(img);
        }
      });
    }, {
      rootMargin: '200px'
    });

    lazyImages.forEach(function(img) {
      imageObserver.observe(img);
    });
  } else {
    // Fallback for older browsers
    lazyImages.forEach(function(img) {
      img.src = img.dataset.src;
    });
  }
});
</script>

{% endblock %}
