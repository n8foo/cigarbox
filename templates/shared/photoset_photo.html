{% extends "layout.html" %}

{# Set Open Graph variables for social media preview #}
{% set og_image = photo.uri %}
{% set og_title = 'Photo from: ' + photoset.title %}
{% set og_url = request.url %}
{% if photo.datetaken %}
{% set og_description = 'Photo taken on ' + (photo.datetaken | format_datetime('%Y-%m-%d')) %}
{% set og_image_alt = 'Photo from ' + (photo.datetaken | format_datetime('%Y-%m-%d')) %}
{% else %}
{% set og_description = 'A photo from ' + photoset.title %}
{% set og_image_alt = 'Photo from ' + photoset.title %}
{% endif %}

{% block body %}

<div class="container">
  <!-- Breadcrumb -->
  <div class="row">
    <div class="col-md-12">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb" style="background-color: var(--bs-secondary-bg); padding: 12px 15px; border-radius: 4px;">
          <li class="breadcrumb-item"><a href="{{SITEURL}}/shared/photoset/{{ share_token.token }}">{{ photoset.title }}</a></li>
          <li class="breadcrumb-item active" aria-current="page">Photo {{ current_pos }} of {{ total_photos }}</li>
        </ol>
      </nav>
    </div>
  </div>

  <!-- Tags -->
  {% set tag_list = tags | list %}
  {% if tag_list %}
  <div class="row">
    <div class="col-md-12">
      <div style="padding: 12px 15px; background-color: var(--bs-secondary-bg); border-radius: 4px; margin-bottom: 10px;">
        <p class="text-muted" style="margin: 0; font-size: 14px;">
          <span class="bi bi-tag"></span> <strong>Tags:</strong>
          {% for tag in tag_list %}
          <span class="badge bg-secondary" style="margin-left: 5px; margin-bottom: 3px;">{{ tag.name }}</span>
          {% endfor %}
        </p>
      </div>
    </div>
  </div>
  {% endif %}
  <hr>

  <!-- Photo Display -->
  <div class="row">
    <div class="col-md-12">
      <div style="position: relative; text-align: center;">
        <img class='img-fluid' style="width: 100%; max-height: 85vh; object-fit: contain;"
             src="{{ signed_s3_url(photo.uri, '_b') }}" alt="Photo">
        {% if share_token.allow_download %}
        <a href="{{SITEURL}}/shared/photoset/{{ share_token.token }}/photo/{{ photo.id }}/download"
           style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; text-decoration: none;">
          <span class="bi bi-download"></span> Download Original
        </a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="row" style="margin-top: 15px;">
    <div class="col-md-12 text-center">
      <div class="btn-group" role="group">
        {% if prev_photo %}
        <a href="{{SITEURL}}/shared/photoset/{{ share_token.token }}/photo/{{ prev_photo.id }}" class="btn btn-secondary">
          <span class="bi bi-chevron-left"></span> Previous
        </a>
        {% else %}
        <button class="btn btn-secondary" disabled>
          <span class="bi bi-chevron-left"></span> Previous
        </button>
        {% endif %}

        <a href="{{SITEURL}}/shared/photoset/{{ share_token.token }}" class="btn btn-primary">
          <span class="bi bi-grid-3x3-gap"></span> Back to Photoset
        </a>

        {% if next_photo %}
        <a href="{{SITEURL}}/shared/photoset/{{ share_token.token }}/photo/{{ next_photo.id }}" class="btn btn-secondary">
          Next <span class="bi bi-chevron-right"></span>
        </a>
        {% else %}
        <button class="btn btn-secondary" disabled>
          Next <span class="bi bi-chevron-right"></span>
        </button>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Photo Details -->
  <div class="row" style="margin-top: 20px;">
    <div class="col-md-12">
      {% if photo.datetaken %}
      <p class="text-muted"><strong>Date Taken:</strong> {{ photo.datetaken | format_datetime }}</p>
      {% endif %}
    </div>
  </div>
</div>
<br><br>

<script>
// Keyboard navigation for prev/next photos
document.addEventListener('keydown', function(e) {
  // Ignore if modifier keys are pressed (Alt/Cmd/Ctrl + arrows for browser navigation)
  if (e.altKey || e.metaKey || e.ctrlKey) {
    return;
  }

  // Arrow keys and vim-style navigation: j=prev, l=next
  if (e.key === 'ArrowLeft' || e.key === 'j' || e.key === 'J') {
    {% if prev_photo %}
    e.preventDefault();
    window.location.href = '{{SITEURL}}/shared/photoset/{{ share_token.token }}/photo/{{ prev_photo.id }}';
    {% endif %}
  } else if (e.key === 'ArrowRight' || e.key === 'l' || e.key === 'L') {
    {% if next_photo %}
    e.preventDefault();
    window.location.href = '{{SITEURL}}/shared/photoset/{{ share_token.token }}/photo/{{ next_photo.id }}';
    {% endif %}
  }
});
</script>

{% endblock %}
