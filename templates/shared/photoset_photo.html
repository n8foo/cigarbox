{% extends "layout.html" %}

{# Set Open Graph variables for social media preview #}
{% set og_image = photo.uri %}
{% set og_title = 'Photo from: ' + photoset.title %}
{% set og_url = request.url %}
{% if photo.datetaken %}
{% set og_description = 'Photo taken on ' + (photo.datetaken | format_datetime('%Y-%m-%d')) %}
{% set og_image_alt = 'Photo from ' + (photo.datetaken | format_datetime('%Y-%m-%d')) %}
{% else %}
{% set og_description = 'A photo from ' + photoset.title %}
{% set og_image_alt = 'Photo from ' + photoset.title %}
{% endif %}

{% block body %}

<div class="container">
  <!-- Breadcrumb and Info -->
  <div class="row">
    <div class="col-md-12">
      <ol class="breadcrumb">
        <li><a href="{{SITEURL}}/shared/photoset/{{ share_token.token }}">{{ photoset.title }}</a></li>
        <li class="active">Photo {{ current_pos }} of {{ total_photos }}</li>
      </ol>

      <div class="alert alert-info">
        <span class="glyphicon glyphicon-info-sign"></span>
        You're viewing a shared photoset.
        {% if share_token.comment %}
        <br><strong>{{ share_token.comment }}</strong>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Photo Display -->
  <div class="row">
    <div class="col-md-12 text-center">
      <div style="position: relative; display: inline-block; max-width: 100%;">
        <img class='img-responsive' src="http://s3.amazonaws.com/{{ config['S3_BUCKET_NAME'] }}/{{ photo.uri }}_b.jpg" alt="Photo" style="max-width: 100%; height: auto;">
        {% if share_token.allow_download %}
        <a href="{{SITEURL}}/shared/photoset/{{ share_token.token }}/photo/{{ photo.id }}/download"
           style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 4px; text-decoration: none;">
          <span class="glyphicon glyphicon-download-alt"></span> Download Original
        </a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="row" style="margin-top: 20px;">
    <div class="col-md-12 text-center">
      <div class="btn-group" role="group">
        {% if prev_photo %}
        <a href="{{SITEURL}}/shared/photoset/{{ share_token.token }}/photo/{{ prev_photo.id }}" class="btn btn-default">
          <span class="glyphicon glyphicon-chevron-left"></span> Previous
        </a>
        {% else %}
        <button class="btn btn-default" disabled>
          <span class="glyphicon glyphicon-chevron-left"></span> Previous
        </button>
        {% endif %}

        <a href="{{SITEURL}}/shared/photoset/{{ share_token.token }}" class="btn btn-primary">
          <span class="glyphicon glyphicon-th"></span> Back to Photoset
        </a>

        {% if next_photo %}
        <a href="{{SITEURL}}/shared/photoset/{{ share_token.token }}/photo/{{ next_photo.id }}" class="btn btn-default">
          Next <span class="glyphicon glyphicon-chevron-right"></span>
        </a>
        {% else %}
        <button class="btn btn-default" disabled>
          Next <span class="glyphicon glyphicon-chevron-right"></span>
        </button>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Photo Details -->
  <div class="row" style="margin-top: 20px;">
    <div class="col-md-12">
      {% set tag_list = tags | list %}
      {% if tag_list %}
      <p>
        <strong>Tags:</strong>
        {% for tag in tag_list %}
        {{ tag.name }}{% if not loop.last %}, {% endif %}
        {% endfor %}
      </p>
      {% endif %}

      {% if photo.datetaken %}
      <p><strong>Date Taken:</strong> {{ photo.datetaken | format_datetime }}</p>
      {% endif %}
    </div>
  </div>
</div>
<br><br>

<script>
// Keyboard navigation for prev/next photos
document.addEventListener('keydown', function(e) {
  // Ignore if modifier keys are pressed (Alt/Cmd/Ctrl + arrows for browser navigation)
  if (e.altKey || e.metaKey || e.ctrlKey) {
    return;
  }

  if (e.key === 'ArrowLeft') {
    {% if prev_photo %}
    e.preventDefault();
    window.location.href = '{{SITEURL}}/shared/photoset/{{ share_token.token }}/photo/{{ prev_photo.id }}';
    {% endif %}
  } else if (e.key === 'ArrowRight') {
    {% if next_photo %}
    e.preventDefault();
    window.location.href = '{{SITEURL}}/shared/photoset/{{ share_token.token }}/photo/{{ next_photo.id }}';
    {% endif %}
  }
});
</script>

{% endblock %}
