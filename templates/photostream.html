{% extends "layout.html" %}
{% from "_pagination.html" import render_pagination %}
{% block body %}

{% if page_title %}
<div class="row">
  <div class="col-md-8">
    <h1>{{ page_title }}</h1>
    {% if photo_count %}
    <p class="lead">{{ photo_count }} photo(s)</p>
    {% endif %}
  </div>
  <div class="col-md-4 text-end">
    {% if photo_ids and current_user.is_authenticated %}
    <a href="{{SITEURL}}/photos/bulk-edit?ids={{ photo_ids }}" class="btn btn-link">
      <span class="bi bi-grid-3x3-gap"></span> bulk edit
    </a>
    {% endif %}
  </div>
</div>
<hr>
{% endif %}


<div class="justified-gallery" id="photo-grid">
  {% for photo in photos %}
  <div style="position: relative; display: inline-block;">
    <a href="{{SITEURL}}/photos/{{ photo.id }}{% if in_context %}?in={{ in_context }}{% endif %}" class="jg-item">
      <img class="lazy jg-photo"
           data-src="http://s3.amazonaws.com/{{ config['S3_BUCKET_NAME'] }}/{{ photo.uri }}_c.jpg"
           src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='320' height='240'%3E%3Crect fill='%23eee' width='320' height='240'/%3E%3C/svg%3E"
           alt="Photo {{ photo.id }}">
    </a>
    {% if current_user.is_authenticated and photo.privacy and photo.privacy > 0 %}
    <span class="privacy-corner-badge" title="{% if photo.privacy == 1 %}Friends only{% elif photo.privacy == 2 %}Family{% elif photo.privacy == 3 %}Private{% endif %}">
      {% if photo.privacy == 1 %}üë•{% elif photo.privacy == 2 %}üë®‚Äçüë©‚Äçüëß{% elif photo.privacy == 3 %}üîí{% endif %}
    </span>
    {% endif %}
  </div>
  {% else %}
  <p class="text-muted">No photos found.</p>
  {% endfor %}
</div>


<!-- Pagination -->
{{ render_pagination(pagination, baseurl) }}

<style>
/* Privacy corner badges */
.privacy-corner-badge {
  position: absolute;
  top: 2px;
  right: 2px;
  background: rgba(255, 255, 255, 0.85);
  padding: 0;
  border-radius: 3px;
  font-size: 10px;
  line-height: 1;
}

[data-bs-theme="dark"] .privacy-corner-badge {
  background: rgba(0, 0, 0, 0.7);
}
</style>

<script>
// Lazy load images
document.addEventListener('DOMContentLoaded', function() {
  var lazyImages = document.querySelectorAll('img.lazy');

  if ('IntersectionObserver' in window) {
    var imageObserver = new IntersectionObserver(function(entries, observer) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          var img = entry.target;
          img.src = img.dataset.src;
          img.classList.remove('lazy');
          imageObserver.unobserve(img);
        }
      });
    }, {
      rootMargin: '200px'
    });

    lazyImages.forEach(function(img) {
      imageObserver.observe(img);
    });
  } else {
    // Fallback for older browsers
    lazyImages.forEach(function(img) {
      img.src = img.dataset.src;
    });
  }
});
</script>


<br><br>
{% endblock %}